prompt --application/deployment/install/upgrade_populate_flex_registry
begin
--   Manifest
--     INSTALL: UPGRADE-Populate flex registry
--   Manifest End
wwv_flow_api.component_begin (
 p_version_yyyy_mm_dd=>'2021.04.15'
,p_release=>'21.1.7'
,p_default_workspace_id=>9008156634332785
,p_default_application_id=>134
,p_default_id_offset=>172493832712964115
,p_default_owner=>'MISO'
);
wwv_flow_api.create_install_script(
 p_id=>wwv_flow_api.id(6243875506029762345)
,p_install_id=>wwv_flow_api.id(9012014618759672631)
,p_name=>'Populate flex registry'
,p_sequence=>370
,p_script_type=>'UPGRADE'
,p_condition_type=>'NOT_EXISTS'
,p_condition=>wwv_flow_string.join(wwv_flow_t_varchar2(
'select null',
'from EBA_PROJ_FLEX_REGISTRY',
'where FLEXIBLE_TABLE = ''EBA_PROJ_STATUS''',
'    and FLEXIBLE_COLUMN = ''PROJECT_FLEX_01'''))
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'declare',
'    type postfixes_t is table of varchar2(30);',
'    l_postfixes postfixes_t := postfixes_t(',
'                          ''01'',''02'',''03'',''04'',',
'                          ''05'',''06'',''07'',''08'',',
'                          ''N01'',''N02'',''N03'',''N04'',',
'                          ''D01'',''D02'',''D03'',''D04'',',
'                          ''CLOB'');',
'    l_projfixes postfixes_t := postfixes_t(',
'                          ''01'',''02'',''03'',''04'',',
'                          ''05'',''06'',''07'',''08'',',
'                          ''N01'',''N02'',''N03'',''N04'',',
'                          ''D01'',''D02'',''D03'',''D04'',',
'                          ''D05'',''D06'',''D07'',''D08'',',
'                          ''D09'',''D10'',''D11'',''D12'',',
'                          ''CLOB'');',
'',
'    type table_r is record (',
'        table_name        varchar2(30),',
'        report_css_class  varchar2(30),',
'        display_name_sing varchar2(128),',
'        display_name_plrl varchar2(128)',
'    );',
'    type tables_t is table of table_r index by varchar2(30);',
'    l_tables tables_t;',
'',
'    l_tbl varchar2(30);',
'begin',
'    l_tables(''PROJECT'').table_name        := ''EBA_PROJ_STATUS'';',
'    l_tables(''PROJECT'').report_css_class  := ''flex_projects'';',
'    l_tables(''PROJECT'').display_name_sing := ''Project'';',
'    l_tables(''PROJECT'').display_name_plrl := ''Projects'';',
'    --',
'    l_tables(''ACTION'').table_name        := ''EBA_PROJ_STATUS_AIS'';',
'    l_tables(''ACTION'').report_css_class  := ''flex_actions'';',
'    l_tables(''ACTION'').display_name_sing := ''Action Item'';',
'    l_tables(''ACTION'').display_name_plrl := ''Action Items'';',
'    --',
'    l_tables(''MILESTONE'').table_name        := ''EBA_PROJ_STATUS_MS'';',
'    l_tables(''MILESTONE'').report_css_class  := ''flex_milestones'';',
'    l_tables(''MILESTONE'').display_name_sing := ''Milestone'';',
'    l_tables(''MILESTONE'').display_name_plrl := ''Milestones'';',
'    -- TODO: Add other tables here as necessary.',
'',
'    l_tbl := l_tables.FIRST;',
'    while l_tbl is not null ',
'    loop',
'        if l_tables(l_tbl).table_name = ''EBA_PROJ_STATUS'' then',
'            for pf in 1..l_projfixes.COUNT ',
'            loop',
'                insert into eba_proj_flex_registry (',
'                    flexible_table,',
'                    flexible_column,',
'                    active_yn,',
'                    form_label_text,',
'                    is_required_yn,',
'                    --',
'                    report_css_class,',
'                    table_prefix,',
'                    display_name_sing,',
'                    display_name_plrl,',
'                    --',
'                    label_template_id,',
'                    display_as,',
'                    width,',
'                    max_width,',
'                    height,',
'                    is_displayed_on_ir,',
'                    assigned_yn,',
'                    --',
'                    condition_type,',
'                    condition1,',
'                    condition2',
'                )',
'                values (',
'                    l_tables(l_tbl).table_name,',
'                    l_tbl||''_FLEX_''||l_projfixes(pf),',
'                    ''N'',',
'                    l_tbl||''_FLEX_''||l_projfixes(pf),',
'                    ''N'',',
'                    --',
'                    l_tables(l_tbl).report_css_class,',
'                    l_tbl,',
'                    l_tables(l_tbl).display_name_sing,',
'                    l_tables(l_tbl).display_name_plrl,',
'                    --',
'                    0,',
'                    case when l_projfixes(pf) = ''CLOB''',
'                        then ''TEXTAREA''',
'                        else ''TEXT''',
'                    end,',
'                    case when l_projfixes(pf) = ''CLOB''',
'                        then 80',
'                        else 30',
'                    end,',
'                    case when l_projfixes(pf) = ''CLOB''',
'                        then 30000',
'                        else 4000',
'                    end,',
'                    case when l_projfixes(pf) = ''CLOB''',
'                        then 5',
'                        else 1',
'                    end,',
'                    ''N'',',
'                    ''N'',',
'                    --',
'                    ''EXISTS'',',
'                    ''select null from eba_proj_flex_registry ''',
'                        ||''where flexible_table = ''''''',
'                        ||l_tables(l_tbl).table_name',
'                        ||'''''' and flexible_column = ''''''',
'                        ||l_tbl||''_FLEX_''||l_projfixes(pf)',
'                        ||'''''' and active_yn = ''''Y''''''',
'                        ||'' and assigned_yn = ''''Y'''''',',
'                    null',
'                );',
'            end loop;',
'        else',
'            for pf in 1..l_postfixes.COUNT ',
'            loop',
'                insert into eba_proj_flex_registry (',
'                    flexible_table,',
'                    flexible_column,',
'                    active_yn,',
'                    form_label_text,',
'                    is_required_yn,',
'                    --',
'                    report_css_class,',
'                    table_prefix,',
'                    display_name_sing,',
'                    display_name_plrl,',
'                    --',
'                    label_template_id,',
'                    display_as,',
'                    width,',
'                    max_width,',
'                    height,',
'                    is_displayed_on_ir,',
'                    assigned_yn,',
'                    --',
'                    condition_type,',
'                    condition1,',
'                    condition2',
'                )',
'                values (',
'                    l_tables(l_tbl).table_name,',
'                    l_tbl||''_FLEX_''||l_postfixes(pf),',
'                    ''N'',',
'                    l_tbl||''_FLEX_''||l_postfixes(pf),',
'                    ''N'',',
'                    --',
'                    l_tables(l_tbl).report_css_class,',
'                    l_tbl,',
'                    l_tables(l_tbl).display_name_sing,',
'                    l_tables(l_tbl).display_name_plrl,',
'                    --',
'                    0,',
'                    case when l_postfixes(pf) = ''CLOB''',
'                        then ''TEXTAREA''',
'                        else ''TEXT''',
'                    end,',
'                    case when l_postfixes(pf) = ''CLOB''',
'                        then 80',
'                        else 30',
'                    end,',
'                    case when l_postfixes(pf) = ''CLOB''',
'                        then 30000',
'                        else 4000',
'                    end,',
'                    case when l_postfixes(pf) = ''CLOB''',
'                        then 5',
'                        else 1',
'                    end,',
'                    ''N'',',
'                    ''N'',',
'                    --',
'                    ''EXISTS'',',
'                    ''select null from eba_proj_flex_registry ''',
'                        ||''where flexible_table = ''''''',
'                        ||l_tables(l_tbl).table_name',
'                        ||'''''' and flexible_column = ''''''',
'                        ||l_tbl||''_FLEX_''||l_postfixes(pf)',
'                        ||'''''' and active_yn = ''''Y''''''',
'                        ||'' and assigned_yn = ''''Y'''''',',
'                    null',
'                );',
'            end loop;',
'        end if;',
'        l_tbl := l_tables.NEXT( l_tbl );',
'    end loop;',
'end;',
'/',
'show errors',
'',
'commit;',
''))
);
wwv_flow_api.component_end;
end;
/
